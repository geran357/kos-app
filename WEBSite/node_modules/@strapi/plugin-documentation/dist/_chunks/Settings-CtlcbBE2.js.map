{"version":3,"file":"Settings-CtlcbBE2.js","sources":["../../admin/src/utils/baseQuery.ts","../../admin/src/components/SettingsForm.tsx","../../admin/src/pages/Settings.tsx"],"sourcesContent":["import { SerializedError } from '@reduxjs/toolkit';\nimport { type UnknownApiError, type ApiError } from '@strapi/strapi/admin';\n\ntype BaseQueryError = ApiError | UnknownApiError | SerializedError;\n\nconst isBaseQueryError = (error: BaseQueryError): error is ApiError | UnknownApiError => {\n  return error.name !== undefined;\n};\n\nexport { isBaseQueryError };\n","import * as React from 'react';\n\nimport {\n  Box,\n  Button,\n  Flex,\n  Grid,\n  TextInput,\n  Toggle,\n  Typography,\n  Field,\n} from '@strapi/design-system';\n// Strapi Icons\nimport { Check, Eye as Show, EyeStriked as Hide } from '@strapi/icons';\nimport { translatedErrors, useRBAC, Layouts } from '@strapi/strapi/admin';\nimport { Form, Formik, FormikHelpers } from 'formik';\nimport { useIntl } from 'react-intl';\nimport { styled } from 'styled-components';\nimport * as yup from 'yup';\n\nimport { PERMISSIONS } from '../constants';\nimport { DocumentInfos, SettingsInput } from '../types';\nimport { getTrad } from '../utils';\n\nconst schema = yup.object().shape({\n  restrictedAccess: yup.boolean(),\n  password: yup.string().when('restrictedAccess', (value, initSchema) => {\n    return value\n      ? initSchema\n          .required(translatedErrors.required.id)\n          .min(8)\n          .matches(/[a-z]/, 'components.Input.error.contain.lowercase')\n          .matches(/[A-Z]/, 'components.Input.error.contain.uppercase')\n          .matches(/\\d/, 'components.Input.error.contain.number')\n      : initSchema;\n  }),\n});\n\nconst FieldActionWrapper = styled(Field.Action)`\n  svg {\n    height: 1.6rem;\n    width: 1.6rem;\n    path {\n      fill: ${({ theme }) => theme.colors.neutral600};\n    }\n  }\n`;\n\ntype SettingsFormProps = {\n  data?: DocumentInfos;\n  onSubmit: (body: SettingsInput, formik: FormikHelpers<SettingsInput>) => Promise<void>;\n};\n\nexport const SettingsForm = ({ data, onSubmit }: SettingsFormProps) => {\n  const { formatMessage } = useIntl();\n  const [passwordShown, setPasswordShown] = React.useState(false);\n  const { allowedActions } = useRBAC(PERMISSIONS);\n\n  return (\n    <Formik\n      enableReinitialize\n      initialValues={{\n        restrictedAccess: data?.documentationAccess.restrictedAccess || false,\n        password: '',\n      }}\n      onSubmit={onSubmit}\n      validationSchema={schema}\n    >\n      {({\n        handleSubmit,\n        values,\n        handleChange,\n        errors,\n        setFieldTouched,\n        setFieldValue,\n        setFieldError,\n        dirty,\n      }) => {\n        return (\n          <Form noValidate onSubmit={handleSubmit}>\n            <Layouts.Header\n              title={formatMessage({\n                id: getTrad('plugin.name'),\n                defaultMessage: 'Documentation',\n              })}\n              subtitle={formatMessage({\n                id: getTrad('pages.SettingsPage.header.description'),\n                defaultMessage: 'Configure the documentation plugin',\n              })}\n              primaryAction={\n                <Button\n                  type=\"submit\"\n                  startIcon={<Check />}\n                  disabled={!dirty && allowedActions.canUpdate}\n                >\n                  {formatMessage({\n                    id: getTrad('pages.SettingsPage.Button.save'),\n                    defaultMessage: 'Save',\n                  })}\n                </Button>\n              }\n            />\n            <Layouts.Content>\n              <Box\n                background=\"neutral0\"\n                hasRadius\n                shadow=\"filterShadow\"\n                paddingTop={6}\n                paddingBottom={6}\n                paddingLeft={7}\n                paddingRight={7}\n              >\n                <Flex direction=\"column\" alignItems=\"stretch\" gap={4}>\n                  <Typography variant=\"delta\" tag=\"h2\">\n                    {formatMessage({\n                      id: 'global.settings',\n                      defaultMessage: 'Settings',\n                    })}\n                  </Typography>\n                  <Grid.Root gap={4}>\n                    <Grid.Item col={6} s={12} direction=\"column\" alignItems=\"stretch\">\n                      <Field.Root\n                        name=\"restrictedAccess\"\n                        hint={formatMessage({\n                          id: getTrad('pages.SettingsPage.toggle.hint'),\n                          defaultMessage: 'Make the documentation endpoint private',\n                        })}\n                      >\n                        <Field.Label>\n                          {formatMessage({\n                            id: getTrad('pages.SettingsPage.toggle.label'),\n                            defaultMessage: 'Restricted Access',\n                          })}\n                        </Field.Label>\n                        <Toggle\n                          checked={values.restrictedAccess}\n                          onChange={() => {\n                            if (values.restrictedAccess === true) {\n                              setFieldValue('password', '', false);\n                              setFieldTouched('password', false, false);\n                              setFieldError('password', undefined);\n                            }\n\n                            setFieldValue('restrictedAccess', !values.restrictedAccess, false);\n                          }}\n                          onLabel=\"On\"\n                          offLabel=\"Off\"\n                        />\n                        <Field.Hint />\n                      </Field.Root>\n                    </Grid.Item>\n                    {values.restrictedAccess && (\n                      <Grid.Item col={6} s={12} direction=\"column\" alignItems=\"stretch\">\n                        <Field.Root\n                          name=\"password\"\n                          error={\n                            errors.password\n                              ? formatMessage({\n                                  id: errors.password,\n                                  defaultMessage: errors.password,\n                                })\n                              : undefined\n                          }\n                        >\n                          <Field.Label>\n                            {formatMessage({\n                              id: 'global.password',\n                              defaultMessage: 'Password',\n                            })}\n                          </Field.Label>\n                          <TextInput\n                            placeholder=\"**********\"\n                            type={passwordShown ? 'text' : 'password'}\n                            value={values.password}\n                            onChange={handleChange}\n                            endAction={\n                              <FieldActionWrapper\n                                onClick={(e) => {\n                                  e.stopPropagation();\n                                  setPasswordShown((prev) => !prev);\n                                }}\n                                label={formatMessage(\n                                  passwordShown\n                                    ? {\n                                        id: 'Auth.form.password.show-password',\n                                        defaultMessage: 'Show password',\n                                      }\n                                    : {\n                                        id: 'Auth.form.password.hide-password',\n                                        defaultMessage: 'Hide password',\n                                      }\n                                )}\n                              >\n                                {passwordShown ? <Show /> : <Hide />}\n                              </FieldActionWrapper>\n                            }\n                          />\n                          <Field.Error />\n                        </Field.Root>\n                      </Grid.Item>\n                    )}\n                  </Grid.Root>\n                </Flex>\n              </Box>\n            </Layouts.Content>\n          </Form>\n        );\n      }}\n    </Formik>\n  );\n};\n","import * as React from 'react';\n\nimport { Main } from '@strapi/design-system';\nimport { useAPIErrorHandler, Page, useNotification } from '@strapi/strapi/admin';\nimport { FormikHelpers } from 'formik';\nimport { useIntl } from 'react-intl';\n\nimport { SettingsForm } from '../components/SettingsForm';\nimport { useGetInfoQuery, useUpdateSettingsMutation } from '../services/api';\nimport { getTrad, isBaseQueryError } from '../utils';\n\nimport type { SettingsInput } from '../types';\n\nconst SettingsPage = () => {\n  const { toggleNotification } = useNotification();\n  const { formatMessage } = useIntl();\n  const {\n    _unstableFormatAPIError: formatAPIError,\n    _unstableFormatValidationErrors: formatValidationErrors,\n  } = useAPIErrorHandler();\n  const { data, isError, isLoading, isFetching } = useGetInfoQuery();\n  const [updateSettings] = useUpdateSettingsMutation();\n\n  const onUpdateSettings = async (body: SettingsInput, formik: FormikHelpers<SettingsInput>) => {\n    return updateSettings({ body })\n      .unwrap()\n      .then(() => {\n        toggleNotification({\n          type: 'success',\n          message: formatMessage({\n            id: getTrad('notification.update.success'),\n            defaultMessage: 'Successfully updated settings',\n          }),\n        });\n      })\n      .catch((err) => {\n        if (isBaseQueryError(err) && err.name === 'ValidationError') {\n          toggleNotification({\n            type: 'danger',\n            message: formatAPIError(err),\n          });\n        }\n      });\n  };\n\n  if (isLoading || isFetching) {\n    return <Page.Loading />;\n  }\n\n  if (isError) {\n    return <Page.Error />;\n  }\n\n  return (\n    <Main>\n      <SettingsForm data={data} onSubmit={onUpdateSettings} />\n    </Main>\n  );\n};\n\nexport { SettingsPage };\n"],"names":["yup","translatedErrors","styled","Field","useIntl","React","useRBAC","PERMISSIONS","jsx","Formik","jsxs","Form","Layouts","getTrad","Button","Check","Box","Flex","Typography","Grid","Toggle","TextInput","Show","Hide","useNotification","useAPIErrorHandler","useGetInfoQuery","useUpdateSettingsMutation","formik","Page","Main"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,MAAM,mBAAmB,CAAC,UAA+D;AACvF,SAAO,MAAM,SAAS;AACxB;ACiBA,MAAM,SAASA,eAAI,OAAO,EAAE,MAAM;AAAA,EAChC,kBAAkBA,eAAI,QAAQ;AAAA,EAC9B,UAAUA,eAAI,OAAO,EAAE,KAAK,oBAAoB,CAAC,OAAO,eAAe;AAC9D,WAAA,QACH,WACG,SAASC,MAAA,iBAAiB,SAAS,EAAE,EACrC,IAAI,CAAC,EACL,QAAQ,SAAS,0CAA0C,EAC3D,QAAQ,SAAS,0CAA0C,EAC3D,QAAQ,MAAM,uCAAuC,IACxD;AAAA,EAAA,CACL;AACH,CAAC;AAED,MAAM,qBAAqBC,iBAAO,OAAAC,mBAAM,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA,cAKhC,CAAC,EAAE,MAAA,MAAY,MAAM,OAAO,UAAU;AAAA;AAAA;AAAA;AAU7C,MAAM,eAAe,CAAC,EAAE,MAAM,eAAkC;AAC/D,QAAA,EAAE,kBAAkBC,UAAAA;AAC1B,QAAM,CAAC,eAAe,gBAAgB,IAAIC,iBAAM,SAAS,KAAK;AAC9D,QAAM,EAAE,eAAA,IAAmBC,MAAA,QAAQC,MAAW,WAAA;AAG5C,SAAAC,2BAAA;AAAA,IAACC,OAAA;AAAA,IAAA;AAAA,MACC,oBAAkB;AAAA,MAClB,eAAe;AAAA,QACb,kBAAkB,MAAM,oBAAoB,oBAAoB;AAAA,QAChE,UAAU;AAAA,MACZ;AAAA,MACA;AAAA,MACA,kBAAkB;AAAA,MAEjB,UAAC,CAAA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAAA,MACI;AACJ,eACGC,2BAAAA,KAAAC,OAAAA,MAAA,EAAK,YAAU,MAAC,UAAU,cACzB,UAAA;AAAA,UAAAH,2BAAA;AAAA,YAACI,MAAAA,QAAQ;AAAA,YAAR;AAAA,cACC,OAAO,cAAc;AAAA,gBACnB,IAAIC,gBAAQ,aAAa;AAAA,gBACzB,gBAAgB;AAAA,cAAA,CACjB;AAAA,cACD,UAAU,cAAc;AAAA,gBACtB,IAAIA,gBAAQ,uCAAuC;AAAA,gBACnD,gBAAgB;AAAA,cAAA,CACjB;AAAA,cACD,eACEL,2BAAA;AAAA,gBAACM,aAAA;AAAA,gBAAA;AAAA,kBACC,MAAK;AAAA,kBACL,0CAAYC,MAAM,OAAA,EAAA;AAAA,kBAClB,UAAU,CAAC,SAAS,eAAe;AAAA,kBAElC,UAAc,cAAA;AAAA,oBACb,IAAIF,gBAAQ,gCAAgC;AAAA,oBAC5C,gBAAgB;AAAA,kBAAA,CACjB;AAAA,gBAAA;AAAA,cACH;AAAA,YAAA;AAAA,UAEJ;AAAA,UACAL,2BAAAA,IAACI,MAAQ,QAAA,SAAR,EACC,UAAAJ,2BAAA;AAAA,YAACQ,aAAA;AAAA,YAAA;AAAA,cACC,YAAW;AAAA,cACX,WAAS;AAAA,cACT,QAAO;AAAA,cACP,YAAY;AAAA,cACZ,eAAe;AAAA,cACf,aAAa;AAAA,cACb,cAAc;AAAA,cAEd,0CAACC,mBAAK,EAAA,WAAU,UAAS,YAAW,WAAU,KAAK,GACjD,UAAA;AAAA,gBAAAT,+BAACU,aAAAA,YAAW,EAAA,SAAQ,SAAQ,KAAI,MAC7B,UAAc,cAAA;AAAA,kBACb,IAAI;AAAA,kBACJ,gBAAgB;AAAA,gBACjB,CAAA,GACH;AAAA,gBACCR,2BAAA,KAAAS,aAAA,KAAK,MAAL,EAAU,KAAK,GACd,UAAA;AAAA,kBAACX,2BAAAA,IAAAW,aAAAA,KAAK,MAAL,EAAU,KAAK,GAAG,GAAG,IAAI,WAAU,UAAS,YAAW,WACtD,UAAAT,2BAAA;AAAA,oBAACP,aAAAA,MAAM;AAAA,oBAAN;AAAA,sBACC,MAAK;AAAA,sBACL,MAAM,cAAc;AAAA,wBAClB,IAAIU,gBAAQ,gCAAgC;AAAA,wBAC5C,gBAAgB;AAAA,sBAAA,CACjB;AAAA,sBAED,UAAA;AAAA,wBAACL,2BAAAA,IAAAL,aAAAA,MAAM,OAAN,EACE,UAAc,cAAA;AAAA,0BACb,IAAIU,gBAAQ,iCAAiC;AAAA,0BAC7C,gBAAgB;AAAA,wBACjB,CAAA,GACH;AAAA,wBACAL,2BAAA;AAAA,0BAACY,aAAA;AAAA,0BAAA;AAAA,4BACC,SAAS,OAAO;AAAA,4BAChB,UAAU,MAAM;AACV,kCAAA,OAAO,qBAAqB,MAAM;AACtB,8CAAA,YAAY,IAAI,KAAK;AACnB,gDAAA,YAAY,OAAO,KAAK;AACxC,8CAAc,YAAY,MAAS;AAAA,8BACrC;AAEA,4CAAc,oBAAoB,CAAC,OAAO,kBAAkB,KAAK;AAAA,4BACnE;AAAA,4BACA,SAAQ;AAAA,4BACR,UAAS;AAAA,0BAAA;AAAA,wBACX;AAAA,wBACAZ,+BAACL,aAAAA,MAAM,MAAN,EAAW;AAAA,sBAAA;AAAA,oBAAA;AAAA,kBAAA,GAEhB;AAAA,kBACC,OAAO,oBACLK,2BAAA,IAAAW,aAAA,KAAK,MAAL,EAAU,KAAK,GAAG,GAAG,IAAI,WAAU,UAAS,YAAW,WACtD,UAAAT,2BAAA;AAAA,oBAACP,aAAAA,MAAM;AAAA,oBAAN;AAAA,sBACC,MAAK;AAAA,sBACL,OACE,OAAO,WACH,cAAc;AAAA,wBACZ,IAAI,OAAO;AAAA,wBACX,gBAAgB,OAAO;AAAA,sBACxB,CAAA,IACD;AAAA,sBAGN,UAAA;AAAA,wBAACK,2BAAAA,IAAAL,aAAAA,MAAM,OAAN,EACE,UAAc,cAAA;AAAA,0BACb,IAAI;AAAA,0BACJ,gBAAgB;AAAA,wBACjB,CAAA,GACH;AAAA,wBACAK,2BAAA;AAAA,0BAACa,aAAA;AAAA,0BAAA;AAAA,4BACC,aAAY;AAAA,4BACZ,MAAM,gBAAgB,SAAS;AAAA,4BAC/B,OAAO,OAAO;AAAA,4BACd,UAAU;AAAA,4BACV,WACEb,2BAAA;AAAA,8BAAC;AAAA,8BAAA;AAAA,gCACC,SAAS,CAAC,MAAM;AACd,oCAAE,gBAAgB;AACD,mDAAA,CAAC,SAAS,CAAC,IAAI;AAAA,gCAClC;AAAA,gCACA,OAAO;AAAA,kCACL,gBACI;AAAA,oCACE,IAAI;AAAA,oCACJ,gBAAgB;AAAA,kCAAA,IAElB;AAAA,oCACE,IAAI;AAAA,oCACJ,gBAAgB;AAAA,kCAClB;AAAA,gCACN;AAAA,gCAEC,UAAgB,gBAAAA,2BAAAA,IAACc,MAAK,KAAA,CAAA,CAAA,mCAAMC,MAAK,YAAA,EAAA;AAAA,8BAAA;AAAA,4BACpC;AAAA,0BAAA;AAAA,wBAEJ;AAAA,wBACAf,+BAACL,aAAAA,MAAM,OAAN,EAAY;AAAA,sBAAA;AAAA,oBAAA;AAAA,kBAAA,GAEjB;AAAA,gBAAA,GAEJ;AAAA,cAAA,GACF;AAAA,YAAA;AAAA,UAAA,GAEJ;AAAA,QACF,EAAA,CAAA;AAAA,MAEJ;AAAA,IAAA;AAAA,EAAA;AAGN;ACrMA,MAAM,eAAe,MAAM;AACnB,QAAA,EAAE,uBAAuBqB,MAAAA;AACzB,QAAA,EAAE,kBAAkBpB,UAAAA;AACpB,QAAA;AAAA,IACJ,yBAAyB;AAAA,IACzB,iCAAiC;AAAA,MAC/BqB,MAAmB,mBAAA;AACvB,QAAM,EAAE,MAAM,SAAS,WAAW,WAAA,IAAeC,QAAAA;AAC3C,QAAA,CAAC,cAAc,IAAIC,QAAAA;AAEnB,QAAA,mBAAmB,OAAO,MAAqBC,YAAyC;AACrF,WAAA,eAAe,EAAE,KAAK,CAAC,EAC3B,OAAO,EACP,KAAK,MAAM;AACS,yBAAA;AAAA,QACjB,MAAM;AAAA,QACN,SAAS,cAAc;AAAA,UACrB,IAAIf,gBAAQ,6BAA6B;AAAA,UACzC,gBAAgB;AAAA,QAAA,CACjB;AAAA,MAAA,CACF;AAAA,IAAA,CACF,EACA,MAAM,CAAC,QAAQ;AACd,UAAI,iBAAiB,GAAG,KAAK,IAAI,SAAS,mBAAmB;AACxC,2BAAA;AAAA,UACjB,MAAM;AAAA,UACN,SAAS,eAAe,GAAG;AAAA,QAAA,CAC5B;AAAA,MACH;AAAA,IAAA,CACD;AAAA,EAAA;AAGL,MAAI,aAAa,YAAY;AACpB,WAAAL,+BAACqB,MAAAA,KAAK,SAAL,CAAa,CAAA;AAAA,EACvB;AAEA,MAAI,SAAS;AACJ,WAAArB,+BAACqB,MAAAA,KAAK,OAAL,CAAW,CAAA;AAAA,EACrB;AAEA,wCACGC,aAAAA,MACC,EAAA,UAAAtB,2BAAAA,IAAC,gBAAa,MAAY,UAAU,iBAAkB,CAAA,EACxD,CAAA;AAEJ;;"}